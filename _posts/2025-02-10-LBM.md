---
layout: post
title: LBM流体仿真
date: 2025-02-09
description: 基于LBM方法实现二维流体仿真
tags: CG Simulation
pretty_table: true
toc:
  sidebar: left
---

> 基于LBM方法实现二维流体仿真。
{: .block-preface }

格子**Boltzmann方法(Lattice Boltzmann Method, LBM)**是一种基于介观(mesoscopic)模拟尺度的计算流体力学(Computational Fluid Dynamics, CFD)方法。和传统CFD方法相比，LBM具有介于微观分子动力学模型和宏观连续模型的介观模型特点，因此具备流体相互作用描述简单、复杂边界易于设置、易于并行计算等优势。在这篇博客中，我们将从零开始一步步构建一个LBM二维仿真器，并利用[NVIDIA Warp](https://nvidia.github.io/warp/)库实现流体实时仿真。

## LBM Theory

### Discretization

LBM是基于网格的计算方法。在宏观层面上，我们需要将流场空间离散成网格，每个网格记录下流体在网格位置上的速度以及密度信息。这些宏观量是我们最终希望从模拟中获得的结果，它们描述了流体的整体行为。

而在微观层面上，每个格子还包含了一组粒子**分布函数(distribution function)**，它们描述了粒子在各个微观方向上流动的概率。以二维LBM最常用的D2Q9模型为例，流体在每个格子上的密度与流速可以由9个微观方向上的分布函数来描述:

$$
\rho(x, y) = \sum_{i=1}^9 f_i (x, y)
$$

$$
\mathbf{u} (x, y) = \frac{1}{\rho (x, y)} \sum_{i=1}^9 f_i (x, y) \mathbf{v}_i
$$

其中每个格子在微观上9个方向的分布函数为$f_i$，而速度$\mathbf{v}_i$则如下图所示。

<div align=center>
<img src="https://search.pstatic.net/common?src=https://en.wikipedia.org/wiki/File:D2Q9_lattice_vectors_for_2D_Lattice_Boltzmann.svg" width="80%">
</div>

### Collide and Stream

LBM在进行流体仿真时的核心在于两个步骤，**碰撞(collide)**和**流动(stream)**。这里"碰撞"是指在每个格子上的粒子实现**均衡(equilibrium)**，在D2Q9模型中均衡分布的计算公式为：

$$
f^{\text{eq}}_i = \rho w_i \bigg[ 1 + 3 (\mathbf{v}_i \cdot \mathbf{u}) + \frac{9}{2} (\mathbf{v}_i \cdot \mathbf{u})^2 - \frac{3}{2} \mathbf{u}^2 \bigg]
$$

其中$w_i$为每个微观方向上速度的权重。均衡分布计算公式的推导过程可以参考[wiki](https://en.wikipedia.org/wiki/Lattice_Boltzmann_methods#Algorithm)，这里不多做赘述。计算出均衡分布后就可以更新微观方向上的分布函数

$$
f^{\text{new}}_i = f_i + \omega (f^{\text{eq}}_i - f_i)
$$

上式中$\omega = \frac{1}{\tau}$为弛豫参数，$\tau$为弛豫时间，描述了流体的黏性。不难发现，LBM碰撞步实际上就是对原始分布函数$f_i$以及均衡分布$f^{\text{eq}}_i$进行一个线性插值。

计算出新的分布函数$f^{\text{new}}_i$后，粒子会沿微观速度方向传播到相邻的网格点，这一过程称为**流动(stream)**。通过交替进行碰撞和流动步骤就可以实现流体仿真。

## LBM Implementation

### Lid-Driven Cavity Flow

### Kármán Vortex Street

### MRT

## Reference

- [LBM方法基本原理及并行计算](https://www.bilibili.com/video/BV1Zb4y1P7L7/?vd_source=7a2542c6c909b3ee1fab551277360826)
- [Homework0 计算流体力学视角的流体求解器](https://forum.taichi-lang.cn/t/homework0/506)
- [LBM Fluid](https://github.com/peng00bo00/LBM-Fluid/tree/main?tab=readme-ov-file)